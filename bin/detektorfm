#!/usr/bin/env ruby 

require 'detektorfm'
require 'optparse'

### options
options = {
  :streams => [],
  :most_played => false,
  :limit => 100
}

OptionParser.new do |opts|
  opts.banner = "detektor.playlist.rb [options]"

  opts.on("-w", "--wort", "Only Wortstream") do |o|
    options[:streams] << "Wortstream"
  end
  
  opts.on("-m", "--musik", "Only Musikstream") do |o|
    options[:streams] << "Musikstream"
  end

  opts.on("-l LIMIT", Integer, "Limit displayed entries") do |limit|
    options[:limit] = limit
  end

  opts.on("-p", "--most-played", "Most played artists last 7 days.") do |o|
    options[:most_played] = o
  end
end.parse!

options[:streams] << "Wortstream" << "Musikstream" if options[:streams].empty?


### main
req = DetektorFm::Request.new 

req.playlist(options[:streams], options[:limit]) do |stream,entries|
  puts stream
  entries.each do |e|
    printf "   %20s   %s - %s\n", e[:time], e[:artist], e[:title]
  end
end

if options[:most_played]
  puts "Most played artists last 7 days"
  req.most_played_artist().each do |a|
    puts "   " + a
  end
end

